{"version":3,"sources":["../../../../src/server/routes/club.js"],"names":["router","Router","get","req","res","next","getAllClubs","then","clubs","status","json","console","log","catch","err","post","club","body","customer","user","removeClubByClubId","id","removeCustomerByCustomerId","_id","params","findCustomerById","find","$in","getAllCredits","clubObj","img","name","address","phoneNumber","openingHours","usersClub","sales","branches","isManual","addClub","push","clubRes","updateCustomer","userClub","clubId","customerId","points","addUserClub","updateClub","isUpdated","customerUpdated"],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,IAAMA,SAAS,kBAAQC,MAAR,EAAf;;AAEAD,OAAOE,GAAP,CAAW,GAAX,EAAgB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAChC,mBAAeC,WAAf,GACCC,IADD,CACO,iBAAS;AACZ,YAAGC,KAAH,EAAU;AACNJ,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAArB;AACH,SAFD,MAGK;AACDG,oBAAQC,GAAR,CAAa,oBAAb;AACAR,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAArB;AACH;AACJ,KATD,EAUCK,KAVD,CAUO,eAAO;AACVF,gBAAQC,GAAR,CAAYE,GAAZ;AACAV,YAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAArB;AACH,KAbD;AAcH,CAfD;;AAkBER,OAAOe,IAAP,CAAY,iBAAZ,EAA+B,UAACZ,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACjD,QAAMW,OAAOb,IAAIc,IAAJ,CAASD,IAAtB;AACA,QAAME,WAAWf,IAAIc,IAAJ,CAASE,IAA1B;;AAEAR,YAAQC,GAAR,CAAY,0BAAZ;AACAD,YAAQC,GAAR,CAAYI,IAAZ;;AAEA,uBAAmBI,kBAAnB,CAAsCF,QAAtC,EAAgDF,KAAKK,EAArD,EACCd,IADD,CACM,2BAAmB;AACrB,uBAAee,0BAAf,CAA0CN,IAA1C,EAAgDE,SAASK,GAAzD,EACChB,IADD,CACM,uBAAe;AACjBH,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,IAArB;AACH,SAHD,EAICG,KAJD,CAIO,eAAO;AACVF,oBAAQC,GAAR,CAAY,sBAAZ,EAAoCE,GAApC;AACAV,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,KAArB;AACH,SAPD;AAQH,KAVD,EAWCG,KAXD,CAWO,eAAO;AACZF,gBAAQC,GAAR,CAAY,0BAAZ,EAAwCE,GAAxC;AACAV,YAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,KAArB;AACD,KAdD;AAeD,CAtBD;;AAyBFV,OAAOE,GAAP,CAAW,WAAX,EAAwB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACxC,QAAMgB,KAAKlB,IAAIqB,MAAJ,CAAWH,EAAtB;;AAEA,uBAAmBI,gBAAnB,CAAoCJ,EAApC,EACCd,IADD,CACM,oBAAY;AACd,4BAAUmB,IAAV,CAAe,EAACH,KAAK,EAAEI,KAAKT,SAASV,KAAhB,EAAN,EAAf,EAA+CD,IAA/C,CAAoD,iBAAS;AACzDH,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEF,OAAQA,KAAV,EAArB;AACH,SAFD;AAGH,KALD;AAMH,CATD;;AAaAR,OAAOE,GAAP,CAAW,UAAX,EAAuB,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AACvC,mBAAeuB,aAAf,GACCrB,IADD,CACO,iBAAS;AACZ,YAAGC,KAAH,EAAU;AACNG,oBAAQC,GAAR,CAAY,8BAAZ;AACAR,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAArB;AACH,SAHD,MAIK;AACDG,oBAAQC,GAAR,CAAa,sBAAb;AACAR,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAArB;AACH;AACJ,KAVD,EAWCK,KAXD,CAWO,eAAO;AACVF,gBAAQC,GAAR,CAAYE,GAAZ;AACAV,YAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBF,KAArB;AACH,KAdD;AAeH,CAhBD;;AAkBAR,OAAOe,IAAP,CAAY,gBAAZ,EAA8B,UAACZ,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC9C,QAAMa,WAAWf,IAAIc,IAAJ,CAASE,IAA1B;AACA,QAAMU,UAAU1B,IAAIc,IAAJ,CAASD,IAAzB;;AAEA,QAAIA,OAAO,yBAAX;AACAA,SAAKK,EAAL,GAAUQ,QAAQR,EAAlB;AACAL,SAAKc,GAAL,GAAWD,QAAQC,GAAnB;AACAd,SAAKe,IAAL,GAAYF,QAAQE,IAApB;AACAf,SAAKgB,OAAL,GAAeH,QAAQG,OAAvB;AACAhB,SAAKiB,WAAL,GAAmBJ,QAAQI,WAA3B;AACAjB,SAAKkB,YAAL,GAAoBL,QAAQK,YAA5B;AACAlB,SAAKmB,SAAL,GAAiBN,QAAQM,SAAzB;AACAnB,SAAKoB,KAAL,GAAaP,QAAQO,KAArB;AACApB,SAAKqB,QAAL,GAAgBR,QAAQQ,QAAxB;AACArB,SAAKsB,QAAL,GAAgBT,QAAQS,QAAxB;;AAKA3B,YAAQC,GAAR,CAAY,6BAAZ;;AAEA,mBAAe2B,OAAf,CAAuBvB,IAAvB,EACCT,IADD,CACM,mBAAW;AACbW,iBAASV,KAAT,CAAegC,IAAf,CAAoBC,OAApB;AACA,2BAAmBC,cAAnB,CAAkCxB,SAASG,EAA3C,EAA+CH,QAA/C,EACCX,IADD,CACM,2BAAmB;AACrBI,oBAAQC,GAAR,CAAY,4BAAZ;AACJ,gBAAM+B,WAAW,6BAAjB;AACEA,qBAASC,MAAT,GAAkBH,QAAQlB,GAA1B;AACAoB,qBAASE,UAAT,GAAsB3B,SAASK,GAA/B;AACAoB,qBAASG,MAAT,GAAkB,CAAlB;AACA,+BAAmBC,WAAnB,CAA+BJ,QAA/B;AACAF,oBAAQN,SAAR,CAAkBK,IAAlB,CAAuBG,QAAvB;AACA,2BAAeK,UAAf,CAA0BP,QAAQpB,EAAlC,EAAsCoB,OAAtC;;AAEArC,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB;AACjBuC,2BAAW,IADM;AAEjB/B,0BAAUgC,eAFO;AAGjBlC,sBAAMyB;AAHW,aAArB;AAKD,SAhBD,EAiBC5B,KAjBD,CAiBO,eAAO;AACZF,oBAAQC,GAAR,CAAY,0BAAZ,EAAwCE,GAAxC;AACAV,gBAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACuC,WAAW,KAAZ,EAArB;AACD,SApBD;AAqBH,KAxBD,EAyBCpC,KAzBD,CAyBO,eAAO;AACVF,gBAAQC,GAAR,CAAY,sBAAZ,EAAoCE,GAApC;AACAV,YAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACuC,WAAW,KAAZ,EAArB;AACH,KA5BD;AA6BD,CAlDH;;AAqDAjD,OAAOe,IAAP,CAAY,gBAAZ,EAA8B,UAACZ,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC9C,QAAMW,OAAOb,IAAIc,IAAJ,CAASD,IAAtB;AACA,QAAME,WAAWf,IAAIc,IAAJ,CAASE,IAA1B;AACA,QAAMwB,WAAW,6BAAjB;;AAEAA,aAASC,MAAT,GAAkB5B,KAAKO,GAAvB;AACAoB,aAASE,UAAT,GAAsB3B,SAASK,GAA/B;AACAoB,aAASG,MAAT,GAAkB,CAAlB;;AAEA,uBAAmBJ,cAAnB,CAAkCxB,SAASG,EAA3C,EAA+CH,QAA/C,EACCX,IADD,CACM,2BAAmB;AACvBI,gBAAQC,GAAR,CAAY,kCAAkCsC,eAA9C;AACA,2BAAmBH,WAAnB,CAA+BJ,QAA/B;AACA3B,aAAKmB,SAAL,CAAeK,IAAf,CAAoBG,QAApB;AACA,uBAAeK,UAAf,CAA0BhC,KAAKK,EAA/B,EAAmCL,IAAnC;;AAEAZ,YAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,IAArB;AACD,KARD,EASCG,KATD,CASO,eAAO;AACZF,gBAAQC,GAAR,CAAY,0BAAZ,EAAwCE,GAAxC;AACAV,YAAIK,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,KAArB;AACD,KAZD;AAaD,CAtBH;;kBA0BeV,M","file":"club.js","sourcesContent":["import express from 'express';\r\nimport mongoose from 'mongoose';\r\nimport Customer from '../.././models/user-model';\r\nimport UserClub from '../.././models/user-club-model';\r\nimport CustomerRepository from '../.././database/repositories/customer.repository';\r\nimport ClubRepository from '../.././database/repositories/club.repository';\r\nimport UserClubRepository from '../.././database/repositories/userClub.repository';\r\nimport ClubModel from '../.././models/club-model';\r\n\r\nconst router = express.Router();\r\n\r\nrouter.get('/', (req, res, next) => {\r\n    ClubRepository.getAllClubs()\r\n    .then( clubs => {\r\n        if(clubs) {\r\n            res.status(200).json(clubs);\r\n        }\r\n        else {\r\n            console.log( \"club.js: no clubs \");\r\n            res.status(200).json(clubs);\r\n        }\r\n    })\r\n    .catch(err => { \r\n        console.log(err);\r\n        res.status(500).json(clubs);\r\n    });\r\n});\r\n\r\n\r\n  router.post('/deleteCustomer', (req, res, next) => {\r\n    const club = req.body.club;\r\n    const customer = req.body.user;\r\n\r\n    console.log(\"in club- deleteCustomer \");\r\n    console.log(club);\r\n\r\n    CustomerRepository.removeClubByClubId(customer, club.id)\r\n    .then(customerUpdated => {\r\n        ClubRepository.removeCustomerByCustomerId(club, customer._id)\r\n        .then(clubUpdated => {\r\n            res.status(200).json(true);\r\n        })\r\n        .catch(err => {\r\n            console.log('Club was not updated', err);\r\n            res.status(500).json(false);\r\n        })\r\n    })\r\n    .catch(err => {\r\n      console.log('Customer was not updated', err);\r\n      res.status(500).json(false);\r\n    });\r\n  });\r\n\r\n\r\nrouter.get('/user/:id', (req, res, next) => {\r\n    const id = req.params.id;\r\n\r\n    CustomerRepository.findCustomerById(id)\r\n    .then(customer => {\r\n        ClubModel.find({_id: { $in: customer.clubs }}).then(clubs => {\r\n            res.status(200).json({ clubs : clubs });\r\n        });\r\n    });\r\n});\r\n\r\n\r\n\r\nrouter.get('/credits', (req, res, next) => {\r\n    ClubRepository.getAllCredits()\r\n    .then( clubs => {\r\n        if(clubs) {\r\n            console.log(\"From server: clubs/credit...\");\r\n            res.status(200).json(clubs);\r\n        }\r\n        else {\r\n            console.log( \"club.js: no credits \");\r\n            res.status(200).json(clubs);\r\n        }\r\n    })\r\n    .catch(err => { \r\n        console.log(err);\r\n        res.status(500).json(clubs);\r\n    });\r\n});\r\n\r\nrouter.post('/addManualClub', (req, res, next) => {\r\n    const customer = req.body.user;\r\n    const clubObj = req.body.club;\r\n\r\n    var club = new ClubModel();\r\n    club.id = clubObj.id;\r\n    club.img = clubObj.img;\r\n    club.name = clubObj.name;\r\n    club.address = clubObj.address;\r\n    club.phoneNumber = clubObj.phoneNumber;\r\n    club.openingHours = clubObj.openingHours;\r\n    club.usersClub = clubObj.usersClub;\r\n    club.sales = clubObj.sales;\r\n    club.branches = clubObj.branches;\r\n    club.isManual = clubObj.isManual;\r\n\r\n    \r\n    \r\n\r\n    console.log(\"From server..addManualClub \");\r\n\r\n    ClubRepository.addClub(club)\r\n    .then(clubRes => {\r\n        customer.clubs.push(clubRes);\r\n        CustomerRepository.updateCustomer(customer.id, customer)\r\n        .then(customerUpdated => {\r\n            console.log(\"return from updateCustomer\");\r\n        const userClub = new UserClub();\r\n          userClub.clubId = clubRes._id;\r\n          userClub.customerId = customer._id;\r\n          userClub.points = 0;\r\n          UserClubRepository.addUserClub(userClub);\r\n          clubRes.usersClub.push(userClub);\r\n          ClubRepository.updateClub(clubRes.id, clubRes);\r\n          \r\n          res.status(200).json({\r\n              isUpdated: true,\r\n              customer: customerUpdated,\r\n              club: clubRes\r\n             });\r\n        })\r\n        .catch(err => {\r\n          console.log('Customer was not updated', err);\r\n          res.status(500).json({isUpdated: false});\r\n        });\r\n    })\r\n    .catch(err => {\r\n        console.log('Club was not updated', err);\r\n        res.status(500).json({isUpdated: false});\r\n    })\r\n  });\r\n\r\n  \r\nrouter.post('/addToCustomer', (req, res, next) => {\r\n    const club = req.body.club;\r\n    const customer = req.body.user;\r\n    const userClub = new UserClub();\r\n\r\n    userClub.clubId = club._id;\r\n    userClub.customerId = customer._id;\r\n    userClub.points = 0;\r\n\r\n    CustomerRepository.updateCustomer(customer.id, customer)\r\n    .then(customerUpdated => {\r\n      console.log(\"return from updateCustomer:\\n\" + customerUpdated);\r\n      UserClubRepository.addUserClub(userClub);\r\n      club.usersClub.push(userClub);\r\n      ClubRepository.updateClub(club.id, club);\r\n      \r\n      res.status(200).json(true);\r\n    })\r\n    .catch(err => {\r\n      console.log('Customer was not updated', err);\r\n      res.status(500).json(false);\r\n    });\r\n  });\r\n\r\n\r\n\r\nexport default router;"]}