{"version":3,"sources":["../../../../src/database/repositories/manager.repository.js"],"names":["addManager","manager","save","removeManager","remove","findManagerById","id","Promise","resolve","reject","findOne","err","findManagerByEmail","email","addClub","clubId","clubs","push","removeClubById","index","i","forEach","splice","addSale","sale","findClubById","then","club","sales","catch","console","log","removeSale","pop","addPointsToCustomerById","customerId","numOfPoints","UsersClub","customer","Points","subscribePointsToCustomerById","addBranchToClub","branchId","branches","removeBranchFromClub","ObjectId","branch"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;kBAGe;AACXA,cADW,sBACAC,OADA,EACS;AAChBA,gBAAQC,IAAR;AACH,KAHU;AAIXC,iBAJW,yBAIGF,OAJH,EAIW;AAClBA,gBAAQG,MAAR;AACH,KANU;AAOXC,mBAPW,2BAOKC,EAPL,EAOS;AAChB,eAAO,IAAIC,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,mCAAaC,OAAb,CAAqB,EAACJ,IAAIA,EAAL,EAArB,EAA+B,UAACK,GAAD,EAAMV,OAAN,EAAkB;AAC7C,oBAAIU,GAAJ,EAASF,OAAOE,GAAP,EAAT,KACKH,QAAQP,OAAR;AACR,aAHD;AAIH,SALM,CAAP;AAMH,KAdU;AAeXW,sBAfW,8BAeQC,KAfR,EAee;AACtB,eAAO,IAAIN,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACpC,mCAAaC,OAAb,CAAqB,EAACG,OAAOA,KAAR,EAArB,EAAqC,UAACF,GAAD,EAAMV,OAAN,EAAkB;AACnD,oBAAGU,GAAH,EAAQF,OAAOE,GAAP,EAAR,KACKH,QAAQP,OAAR;AACR,aAHD;AAIH,SALM,CAAP;AAMH,KAtBU;AAuBXa,WAvBW,mBAuBHb,OAvBG,EAuBMc,MAvBN,EAuBa;AACpBd,gBAAQe,KAAR,CAAcC,IAAd,CAAmBF,MAAnB;AACAd,gBAAQC,IAAR;AACH,KA1BU;AA2BXgB,kBA3BW,0BA2BIjB,OA3BJ,EA2Bac,MA3Bb,EA2BoB;AAC3B,YAAII,KAAJ;AACA,YAAIC,IAAG,CAAP;;AAEAnB,gBAAQe,KAAR,CAAcK,OAAd,CAAsB,UAASf,EAAT,EAAa;AAC/B,gBAAGS,UAAUT,EAAb,EACIa,QAAQC,CAAR;AACJA;AACH,SAJD,EAIG,IAJH;;AAMAnB,gBAAQe,KAAR,CAAcM,MAAd,CAAqBH,KAArB,EAA4B,CAA5B;AACAlB,gBAAQC,IAAR;AACA;AACH,KAxCU;AAyCVqB,WAzCU,mBAyCFR,MAzCE,EAyCMS,IAzCN,EAyCW;AAClB,eAAO,eAAUC,YAAV,CAAuBV,MAAvB,EACNW,IADM,CACD,gBAAQ;AACTC,iBAAKC,KAAL,CAAWX,IAAX,CAAgBO,IAAhB;AACAG,iBAAKzB,IAAL;AACC,SAJC,EAKN2B,KALM,CAKA,eAAO;AACVC,oBAAQC,GAAR,CAAYpB,GAAZ;AACH,SAPM,CAAP;AAQH,KAlDU;AAmDXqB,cAnDW,sBAmDAjB,MAnDA,EAmDQS,IAnDR,EAmDa;AACrB,eAAO,eAAUC,YAAV,CAAuBV,MAAvB,EACLW,IADK,CACA,gBAAQ;AACTC,iBAAKC,KAAL,CAAWK,GAAX,CAAeT,IAAf;AACAG,iBAAKzB,IAAL;AACH,SAJI,EAKL2B,KALK,CAKC,eAAO;AACdC,oBAAQC,GAAR,CAAYpB,GAAZ;AACC,SAPK,CAAP;AAQF,KA5DU;AA6DXuB,2BA7DW,mCA6DaC,UA7Db,EA6DyBpB,MA7DzB,EA6DiCqB,WA7DjC,EA6D6C;AACpD,uBAAUX,YAAV,CAAuBV,MAAvB,EACCW,IADD,CACM,gBAAO;AACLC,iBAAKU,SAAL,CAAe3B,OAAf,CAAuB,EAACyB,YAAYA,UAAb,EAAvB,EAAiD,UAACxB,GAAD,EAAM2B,QAAN,EAAmB;AACpE,oBAAG3B,GAAH,EAAO;AACHmB,4BAAQC,GAAR,CAAY,sBAAZ;AACH,iBAFD,MAGI;AACAO,6BAASC,MAAT,IAAmBH,WAAnB;AACAN,4BAAQC,GAAR,CAAY,4BAAZ;AACH;AACJ,aARG;AASP,SAXD,EAYCF,KAZD,CAYO,eAAO;AACdC,oBAAQC,GAAR,CAAYpB,GAAZ;AACC,SAdD;AAeH,KA7EU;AA8EX6B,iCA9EW,yCA8EmBL,UA9EnB,EA8E+BR,IA9E/B,EA8EqCS,WA9ErC,EA8EiD;AACxD,uBAAUX,YAAV,CAAuBV,MAAvB,EACCW,IADD,CACM,gBAAO;AACLC,iBAAKU,SAAL,CAAe3B,OAAf,CAAuB,EAACyB,YAAYA,UAAb,EAAvB,EAAiD,UAACxB,GAAD,EAAM2B,QAAN,EAAmB;AACpE,oBAAG3B,GAAH,EAAO;AACHmB,4BAAQC,GAAR,CAAY,sBAAZ;AACH,iBAFD,MAGI;AACAO,6BAASC,MAAT,IAAmBH,WAAnB;AACAN,4BAAQC,GAAR,CAAY,mCAAZ;AACH;AACJ,aARG;AASP,SAXD,EAYCF,KAZD,CAYO,eAAO;AACdC,oBAAQC,GAAR,CAAYpB,GAAZ;AACC,SAdD;AAeH,KA9FU;AA+FX8B,mBA/FW,2BA+FK1B,MA/FL,EA+Fa2B,QA/Fb,EA+FsB;AAC7B,uBAAUjB,YAAV,CAAuBV,MAAvB,EACCW,IADD,CACM,gBAAO;AACTC,iBAAKgB,QAAL,CAAc1B,IAAd,CAAmByB,QAAnB;AACAf,iBAAKzB,IAAL;AACH,SAJD,EAKC2B,KALD,CAKO,eAAM;AACTC,oBAAQC,GAAR,CAAYpB,GAAZ;AACH,SAPD;AAQH,KAxGU;AAyGXiC,wBAzGW,gCAyGU7B,MAzGV,EAyGkB2B,QAzGlB,EAyG2B;AAClC,uBAAUjB,YAAV,CAAuBV,MAAvB,EACCW,IADD,CACM,gBAAO;AACTC,iBAAKU,SAAL,CAAe3B,OAAf,CAAuB,EAACmC,UAAUH,QAAX,EAAvB,EAA6C,UAAC/B,GAAD,EAAMmC,MAAN,EAAiB;AAC1D,oBAAGnC,GAAH,EAAO;AACHmB,4BAAQC,GAAR,CAAY,sBAAZ;AACH,iBAFD,MAGI;AACAJ,yBAAKgB,QAAL,CAAcV,GAAd,CAAkBa,MAAlB;AACAnB,yBAAKzB,IAAL;AACA4B,4BAAQC,GAAR,CAAY,gBAAZ;AACH;AACH,aATF;AAUH,SAZD,EAaCF,KAbD,CAaO,eAAM;AACTC,oBAAQC,GAAR,CAAYpB,GAAZ;AACH,SAfD;AAgBH;AA1HU,C","file":"manager.repository.js","sourcesContent":["import ManagerModel from '../../models/manager-model';\r\nimport clubModel from './club.repository';\r\n\r\n\r\nexport default {\r\n    addManager(manager) {\r\n        manager.save();\r\n    },\r\n    removeManager(manager){\r\n        manager.remove();\r\n    },\r\n    findManagerById(id) {\r\n        return new Promise((resolve, reject) => {\r\n            ManagerModel.findOne({id: id}, (err, manager) => {\r\n                if (err) reject(err);\r\n                else resolve(manager);\r\n            });\r\n        });\r\n    },\r\n    findManagerByEmail(email) {\r\n        return new Promise((resolve, reject) => {\r\n            ManagerModel.findOne({email: email}, (err, manager) => {\r\n                if(err) reject(err);\r\n                else resolve(manager);\r\n            });\r\n        });\r\n    },\r\n    addClub(manager, clubId){\r\n        manager.clubs.push(clubId);\r\n        manager.save();\r\n    },\r\n    removeClubById(manager, clubId){\r\n        var index;\r\n        var i =0;\r\n        \r\n        manager.clubs.forEach(function(id) {\r\n            if(clubId == id )\r\n                index = i;\r\n            i++;\r\n        }, this);\r\n\r\n        manager.clubs.splice(index, 1);\r\n        manager.save();\r\n        //TODO : delete this club also\r\n    },\r\n     addSale(clubId, sale){\r\n        return clubModel.findClubById(clubId)\r\n        .then(club => {\r\n             club.sales.push(sale);          \r\n             club.save();    \r\n             })\r\n        .catch(err => {\r\n            console.log(err);  \r\n        })\r\n    },\r\n    removeSale(clubId, sale){\r\n       return clubModel.findClubById(clubId)\r\n        .then(club => {\r\n             club.sales.pop(sale);\r\n             club.save();\r\n         })\r\n        .catch(err => {\r\n        console.log(err);  \r\n        })\r\n    },\r\n    addPointsToCustomerById(customerId, clubId, numOfPoints){\r\n        clubModel.findClubById(clubId)\r\n        .then(club =>{\r\n                club.UsersClub.findOne({customerId: customerId}, (err, customer) => {\r\n                if(err){\r\n                    console.log(\"CustomerId not found\");\r\n                }\r\n                else{\r\n                    customer.Points += numOfPoints;\r\n                    console.log(\"adding points to costumer!\");\r\n                }\r\n            });\r\n        })\r\n        .catch(err => {\r\n        console.log(err);  \r\n        })\r\n    },\r\n    subscribePointsToCustomerById(customerId, club, numOfPoints){\r\n        clubModel.findClubById(clubId)\r\n        .then(club =>{\r\n                club.UsersClub.findOne({customerId: customerId}, (err, customer) => {\r\n                if(err){\r\n                    console.log(\"CustomerId not found\");\r\n                }\r\n                else{\r\n                    customer.Points -= numOfPoints;\r\n                    console.log(\"addsubscribei points to costumer!\");\r\n                }\r\n            });\r\n        })\r\n        .catch(err => {\r\n        console.log(err);  \r\n        })\r\n    },\r\n    addBranchToClub(clubId, branchId){\r\n        clubModel.findClubById(clubId)\r\n        .then(club =>{\r\n            club.branches.push(branchId);\r\n            club.save();\r\n        })\r\n        .catch(err =>{\r\n            console.log(err);\r\n        })\r\n    },\r\n    removeBranchFromClub(clubId, branchId){\r\n        clubModel.findClubById(clubId)\r\n        .then(club =>{\r\n            club.UsersClub.findOne({ObjectId: branchId}, (err, branch) => {\r\n                if(err){\r\n                    console.log(\"Branch doesn't exist\");\r\n                }\r\n                else{\r\n                    club.branches.pop(branch);\r\n                    club.save();\r\n                    console.log(\"branch removed\");\r\n                }\r\n             });\r\n        })\r\n        .catch(err =>{\r\n            console.log(err);\r\n        })\r\n    }\r\n}\r\n"]}